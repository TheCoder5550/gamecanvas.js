function GameCanvas(t,n,o,e){var d=this;0==arguments.length&&(t=null,n="FULLSCREEN"),"string"==typeof t&&(t=document.getElementById(t)),this.canvas=t||document.body.appendChild(document.createElement("canvas")),n=n||"FULLSCREEN",this.canvas.height="FULLSCREEN"==n?(e=o||e,document.body.style=e&&e.appliedBodyStyle||"padding: 0;margin: 0;overflow: hidden;",window.innerHeight):o,this.canvas.width="FULLSCREEN"==n?window.innerWidth:n,this.ctx=this.canvas.getContext("2d"),this.settings=e,this.globalFunctions=!e||!e.hasOwnProperty("globalFunctions")||e.globalFunctions,this.topFunction=this.globalFunctions?window:this,this.imagesToLoad=0,this.preloadedImages=[],this.storedImages=[],this.storedImageData=[],this.topFunction.width=this.canvas.width,this.topFunction.height=this.canvas.height,this.topFunction.isItWorking=function(){msg="Yup, it's working!\n(This function can be removed from your code now if you want)",console.log(msg)},window.onload=function(){"undefined"!=typeof preload&&"function"==typeof preload?preload():d.callFunctions()},this.callFunctions=function(){if("undefined"!=typeof start&&start(),"undefined"!=typeof loop){var t=loop;loop=function(){t(),requestAnimationFrame(loop)},loop()}},this.topFunction.clearScreen=function(){d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height)},this.topFunction.background=function(t){d.ctx.beginPath(),d.ctx.fillStyle=t,d.ctx.fillRect(0,0,d.topFunction.width,d.topFunction.height),d.ctx.closePath()},this.topFunction.drawRectangle=function(t,n,o,e,i,a,c){d.ctx.beginPath(),d.ctx.rect(t,n,o,e),d.topFunction.renderShape(i,a,c)},this.topFunction.rect=this.topFunction.drawRectangle,this.topFunction.rectangle=this.topFunction.drawRectangle,this.topFunction.drawCircle=function(t,n,o,e,i,a){d.ctx.beginPath(),d.ctx.arc(t,n,o,0,2*Math.PI),d.ctx.closePath(),d.topFunction.renderShape(e,i,a)},this.topFunction.circle=this.topFunction.drawCircle,this.topFunction.drawRing=function(t,n,o,e,i){d.topFunction.drawCircle(t,n,o,"",e,i?{lineWidth:i}:void 0)},this.topFunction.ring=this.topFunction.drawRing,this.topFunction.drawTriangle=function(t,n,o,e,i,a,c,u,s){d.ctx.beginPath(),t.hasOwnProperty("x")?(d.ctx.moveTo(t.x,t.y),d.ctx.lineTo(n.x,n.y),d.ctx.lineTo(o.x,o.y),color=e,s=i):(d.ctx.moveTo(t,n),d.ctx.lineTo(o,e),d.ctx.lineTo(i,a)),d.ctx.closePath(),d.topFunction.renderShape(c,u,s)},this.topFunction.triangle=this.topFunction.drawTriangle,this.topFunction.tri=this.topFunction.drawTriangle,this.topFunction.drawTriangleEquilateral=function(t,n,o,e,i,a){var c=t+Math.cos(30*Math.PI/180)*(a&&a.width||o),u=n+Math.sin(30*Math.PI/180)*(a&&a.height||o),s=t+Math.cos(150*Math.PI/180)*(a&&a.width||o),r=n+Math.sin(150*Math.PI/180)*(a&&a.height||o),h=t,p=n-o;d.topFunction.drawTriangle(c,u,s,r,h,p,e,i,a)},this.topFunction.triangleEq=this.topFunction.drawTriangleEquilateral,this.topFunction.drawRegularPolygon=function(t,n,o,e,i,a,c){d.ctx.beginPath();for(var u=-90;u<270;u+=360/e){var s=t+Math.cos(u*Math.PI/180)*(c&&c.width||o),r=n+Math.sin(u*Math.PI/180)*(c&&c.height||o);-90==u?d.ctx.moveTo(s,r):d.ctx.lineTo(s,r)}d.ctx.closePath(),d.topFunction.renderShape(i,a,c)},this.topFunction.regPolygon=this.topFunction.drawRegularPolygon,this.topFunction.drawEllipse=function(t,n,o,e,i,a,c){d.ctx.beginPath(),d.ctx.ellipse(t,n,o,e,c&&c.rotation||0,0,2*Math.PI),d.ctx.closePath(),d.topFunction.renderShape(i,a,c)},this.topFunction.ellipse=this.topFunction.drawEllipse,this.topFunction.oval=this.topFunction.drawEllipse,this.topFunction.preloadImage=function(n){var t=d.preloadedImages.find(function(t){return t.src===n});if(console.log("Preloading image... "+n),!t){d.imagesToLoad++;var o=new Image;return o.src=n,o.onload=function(){d.imagesToLoad--,d.imagesToLoad<=0&&d.callFunctions(),console.log("Image preloaded! "+o.src)},d.preloadedImages.push({src:n,image:o}),o}},this.topFunction.drawImage=function(n,t,o,e,i,a){var c=d.preloadedImages.find(function(t){return t.src===n});if(c)a&&void 0!==a.rotation&&null!==a.rotation?(d.ctx.save(),d.ctx.translate(t,o),d.ctx.rotate(a.rotation),d.ctx.drawImage(c.image,-e/2,-i/2,e,i),d.ctx.restore()):d.ctx.drawImage(c.image,t,o,e,i);else{var u=d.topFunction.preloadImage(n);u.onload=function(){d.ctx.drawImage(u,t,o,e,i)}}},this.topFunction.image=this.topFunction.drawImage,this.topFunction.picture=this.topFunction.drawImage,this.topFunction.imageReadPixel=function(n,t,o){var e=d.storedImageData.find(function(t){return t.src===n});if(e)return e.imagePixelReader.isDoneLoading?e.imagePixelReader.readPixel(t,o):"Data is added, but has not loaded yet";var i=new d.topFunction.ImagePixelReader(n);return d.storedImageData.push({src:n,imagePixelReader:i}),i.readPixel(t,o)},this.topFunction.ImagePixelReader=function(n){var e=this,t=d.preloadedImages.find(function(t){return t.src===n});t?(e.image=t.image,e.isDoneLoading=!0,e.canvas=document.createElement("canvas"),e.canvas.width=e.image.width,e.canvas.height=e.image.height,e.ctx=e.canvas.getContext("2d"),e.ctx.drawImage(e.image,0,0),e.imageData=e.ctx.getImageData(0,0,e.image.width,e.image.height).data):console.error("Please preload image before getting data!"),this.readPixel=function(t,n){if(e.isDoneLoading){var o=4*(t+n*e.image.height);return[e.imageData[o],e.imageData[o+1],e.imageData[o+2],e.imageData[o+3]]}console.log("Is loading!..")},this.onload=function(){}},this.topFunction.drawLine=function(t,n,o,e,i,a){d.ctx.beginPath(),t.hasOwnProperty("x")?(d.ctx.moveTo(t.x,t.y),d.ctx.lineTo(n.x,n.y),i=o,a=e):(d.ctx.moveTo(t,n),d.ctx.lineTo(o,e)),d.ctx.closePath(),d.ctx.lineCap=a&&a.roundedCorners?"round":"butt",d.ctx.strokeStyle=i,d.ctx.lineWidth=a&&a.lineWidth||2,d.ctx.stroke()},this.topFunction.line=this.topFunction.drawLine,this.topFunction.drawPoint=function(t,n){t.hasOwnProperty("x")&&(n=t.y,t=t.x),d.topFunction.drawCircle(t,n,5,"black")},this.topFunction.point=this.topFunction.drawPoint,this.topFunction.drawText=function(t,n,o,e,i,a,c){"object"==typeof a&&"[object Object]"===a.toString()&&(c=a,a=""),d.ctx.beginPath(),d.ctx.font=(e||30)+"px "+(c&&c.fontFamily)||"Arial",d.ctx.textAlign=c&&c.alignText||"left",d.ctx.lineWidth=c&&c.lineWidth||2,d.ctx.closePath(),i&&(d.ctx.fillStyle=i,d.ctx.fillText(t,n,o)),a&&(d.ctx.strokeStyle=a,d.ctx.strokeText(t,n,o))},this.topFunction.text=this.topFunction.drawText,this.topFunction.drawPolygon=function(t,n,o,e){var i=t.constructor===Array?t:arguments;d.ctx.beginPath(),d.ctx.moveTo(i[0].x,i[0].y);for(var a=1;a<i.length;a++){var c=i[a];d.ctx.lineTo(c.x,c.y)}d.ctx.closePath(),d.topFunction.renderShape(n,o,e)},this.topFunction.polygon=this.topFunction.drawPolygon,this.topFunction.gradient=function(t,n,o,e){var i;i=t.constructor===Array?(o,o=n,t):[t,n];for(var a=d.ctx.createLinearGradient(0,0,0,o||100),c=0;c<i.length;c++)a.addColorStop(1/(i.length-1)*c,i[c]);return a},this.topFunction.beginShape=function(){d.ctx.beginPath()},this.topFunction.moveTo=function(t,n){d.ctx.moveTo(t,n)},this.topFunction.lineTo=function(t,n){d.ctx.lineTo(t,n)},this.topFunction.curveTo=function(t,n,o,e){d.ctx.quadraticCurveTo(o,e,t,n)},this.topFunction.closeShape=function(){d.ctx.closePath()},this.topFunction.renderShape=function(t,n,o){"object"==typeof t&&"[object Object]"===t.toString()&&(o=t,t=""),"object"==typeof n&&"[object Object]"===n.toString()&&(o=n,n=""),d.ctx.lineJoin=o&&o.roundedCorners?"round":"miter",d.ctx.lineWidth=o&&o.lineWidth||2,o&&o.hasOwnProperty("fillColor")&&(d.ctx.fillStyle=o.fillColor,d.ctx.fill()),o&&o.hasOwnProperty("strokeColor")&&(d.ctx.strokeStyle=o.strokeColor,d.ctx.stroke()),t&&(d.ctx.fillStyle=t,d.ctx.fill()),n&&(d.ctx.strokeStyle=n,d.ctx.stroke())},this.topFunction.pixels=[],this.imageData,this.topFunction.updatePixelData=function(){d.imageData=d.ctx.getImageData(0,0,d.canvas.width,d.canvas.height),d.topFunction.pixels=d.imageData.data},this.topFunction.updatePixel=function(t,n,o,e,i,a){var c=4*(t+n*d.canvas.width);d.topFunction.pixels[c]=o,d.topFunction.pixels[c+1]=e,d.topFunction.pixels[c+2]=i,d.topFunction.pixels[c+3]=void 0===a?255:a},this.topFunction.readPixel=function(t,n){var o=4*(t+n*d.canvas.width);return[d.topFunction.pixels[o],d.topFunction.pixels[o+1],d.topFunction.pixels[o+2],d.topFunction.pixels[o+3]]},this.topFunction.renderPixelData=function(){d.ctx.putImageData(d.imageData,0,0)},this.topFunction.getDistance=function(t,n,o,e){t.hasOwnProperty("x")&&(e=n.y,o=n.x,n=t.y,t=t.x);var i=t-o,a=n-e;return Math.sqrt(i*i+a*a)},this.topFunction.distance=this.topFunction.getDistance,this.topFunction.getAngle=function(t,n,o,e,i){return t.hasOwnProperty("x")&&(i=o,e=n.y,o=n.x,n=t.y,t=t.x),i&&i.angleMode&&("DEG"==i.angleMode.toUpperCase()||"DEGREES"==i.angleMode.toUpperCase())?180*Math.atan2(e-n,o-t)/Math.PI:i&&i.angleMode&&("RAD"==i.angleMode.toUpperCase()||"RADIUS"==i.angleMode.toUpperCase())||!i?Math.atan2(e-n,o-t):void 0},this.topFunction.random=function(t,n){return void 0===n?Math.random()*t:Math.random()*(n-t)+t},this.topFunction.randomInt=function(t,n){return void 0===n?Math.random()*t>>0:Math.random()*(n-t)+t>>0},this.topFunction.random=this.topFunction.randomInt,this.topFunction.randomArray=function(t){return t[Math.random()*t.length>>0]},this.topFunction.canvasToURL=function(){return d.canvas.toDataURL()},this.topFunction.canvasToImage=function(){var t=new Image;return t.src=d.canvas.toDataURL(),t},this.topFunction.downloadCanvasPNG=function(t){var n=document.createElement("a");n.download=t||"downloadCanvasPNG.png",n.href=d.canvas.toDataURL(),n.click()},this.topFunction.swap=function(t,n){return[n,t]},this.topFunction.createArray=function(t,n){return function t(n,o,e){var i=new Array(e);for(var a=0;a<i.length;a++)i[a]=n<o-2?t(n+1,o,e):new Array(e);return i}(0,t,n||10)},this.topFunction.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.topFunction.mouseX=0,this.topFunction.mouseY=0,this.topFunction.touch={x:0,y:0,touching:!1,touches:[]},this.keyNumber=[],this.keyName=[],this.topFunction.isKeyPressed=function(t){return isNaN(t)?!!d.keyName[t]:!!d.keyNumber[t]},this.topFunction.getKey=this.topFunction.isKeyPressed,this.canvas.addEventListener("mousemove",function(t){var n=d.canvas.getBoundingClientRect();d.topFunction.mouse.x=d.topFunction.mouseX=Math.round((t.clientX-n.left)*(d.topFunction.width/n.width)),d.topFunction.mouse.y=d.topFunction.mouseY=Math.round((t.clientY-n.top)*(d.topFunction.height/n.height)),"function"==typeof OnMouseMove&&OnMouseMove()}),this.canvas.addEventListener("mousedown",function(t){switch(t.which){case 1:d.topFunction.mouse.left=!0;break;case 2:d.topFunction.mouse.middle=!0;break;case 3:d.topFunction.mouse.right=!0}"function"==typeof OnMouseDown&&OnMouseDown()}),this.canvas.addEventListener("mouseup",function(t){switch(t.which){case 1:d.topFunction.mouse.left=!1;break;case 2:d.topFunction.mouse.middle=!1;break;case 3:d.topFunction.mouse.right=!1}"function"==typeof OnMouseUp&&OnMouseUp()}),this.canvas.addEventListener("touchstart",function(t){t.preventDefault(),i(t),d.topFunction.touch.x=t.touches[0].pageX,d.topFunction.touch.y=t.touches[0].pageY,d.topFunction.touch.touching=!0,"function"==typeof OnTouchStart&&OnTouchStart()}),this.canvas.addEventListener("touchend",function(t){t.preventDefault(),i(t),d.topFunction.touch.touching=!1,"function"==typeof OnTouchEnd&&OnTouchEnd()}),this.canvas.addEventListener("touchmove",function(t){t.preventDefault(),i(t),d.settings.setMouseToTouch?(d.topFunction.touch.x=d.topFunction.mouse.x=d.topFunction.mouseX=t.touches[0].pageX,d.topFunction.touch.y=d.topFunction.mouse.y=d.topFunction.mouseY=t.touches[0].pageY):(d.topFunction.touch.x=t.touches[0].pageX,d.topFunction.touch.y=t.touches[0].pageY),"function"==typeof OnTouchMove&&OnTouchMove()});var i=function(t){d.topFunction.touch.touches=[];for(var n=0;n<t.touches.length;n++)d.topFunction.touch.touches.push({x:t.touches[n].pageX,y:t.touches[n].pageY,id:t.touches[n].identifier})};document.addEventListener("keydown",function(t){d.keyNumber[t.which]=!0,d.keyName[t.key]=!0,"function"==typeof OnKeyDown&&OnKeyDown()}),document.addEventListener("keyup",function(t){d.keyNumber[t.which]=!1,d.keyName[t.key]=!1,"function"==typeof OnKeyUp&&OnkeyUp()})}
