!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GameCanvas=e():t.GameCanvas=e()}(this,()=>(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>i});class i{constructor(t,e={}){if(this.eventHandler=new s,this.on=this.eventHandler.on.bind(this.eventHandler),t instanceof HTMLCanvasElement)this.canvas=t;else if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error("Could not find "+t);if(!(e instanceof HTMLCanvasElement))throw new Error("Query element is not a canvas");this.canvas=e}else{if(void 0!==t)throw console.error("Value passed:",t),new Error("Value passed as canvas is not a canvas element");this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas)}this.ctx=this.canvas.getContext("2d"),function(t){let e=null;const i=()=>{null!=e&&e();const s=`(resolution: ${window.devicePixelRatio}dppx)`,n=matchMedia(s);n.addEventListener("change",i),e=()=>{n.removeEventListener("change",i)},t.dpr=window.devicePixelRatio||1,t.eventHandler.fireEvent("dprChange",t.dpr)};i()}(this),this._forceUpdatePixelRatio=()=>{this.dpr=window.devicePixelRatio||1};let o=300,a=150;if(e.hasOwnProperty("width")){if(isNaN(e.width))throw Error("Width is not a number: "+e.width);o=e.width}if(e.hasOwnProperty("height")){if(isNaN(e.height))throw Error("Height is not a number: "+e.height);a=e.height}if(h(this,o,a),this.isFullpage=!(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(!e.hasOwnProperty("noFullscreen")||e.hasOwnProperty("noFullscreen")&&!e.noFullscreen),this.isFullpage?(h(this,window.innerWidth+1,window.innerHeight+1),this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",document.body.style.overflow="hidden",this.disableContextMenu=!e.hasOwnProperty("disableContextMenu")||e.disableContextMenu,this.disableMiddleMouse=!e.hasOwnProperty("disableMiddleMouse")||e.disableMiddleMouse,this.disableScrollOnMobile=!e.hasOwnProperty("disableScrollOnMobile")||e.disableScrollOnMobile,this.disableKeyShortcuts=!!e.hasOwnProperty("disableKeyShortcuts")&&e.disableKeyShortcuts,this.updateCanvasSizeOnResize=!e.hasOwnProperty("updateCanvasSizeOnResize")||e.updateCanvasSizeOnResize,this.publicMethods=!e.hasOwnProperty("publicMethods")||e.publicMethods):(this.disableContextMenu=!!e.hasOwnProperty("disableContextMenu")&&e.disableContextMenu,this.disableMiddleMouse=!!e.hasOwnProperty("disableMiddleMouse")&&e.disableMiddleMouse,this.disableScrollOnMobile=!!e.hasOwnProperty("disableScrollOnMobile")&&e.disableScrollOnMobile,this.disableKeyShortcuts=!!e.hasOwnProperty("disableKeyShortcuts")&&e.disableKeyShortcuts,this.updateCanvasSizeOnResize=!!e.hasOwnProperty("updateCanvasSizeOnResize")&&e.updateCanvasSizeOnResize,this.publicMethods=!e.hasOwnProperty("publicMethods")||e.publicMethods),this.font="Arial",this.fontWeight="normal",this.images=[],this.imageData=void 0,this.imageDataData=void 0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.keys={keysDown:[],ctrlPressed:!1,shiftSPressed:!1,altPressed:!1},this.mouse={x:0,y:0,lastX:0,lastY:0,movementX:0,movementY:0,left:!1,right:!1,middle:!1,any:!1,scrollX:0,scrollY:0,scrollZ:0},this.mouseLookupTable=["left","middle","right"],this.touch={lastX:0,lastY:0,x:0,y:0,movementX:0,movementY:0,isTouching:!1,nrTouches:0,touches:[],lastTouches:[]},this.pan={isPanning:!1},this.ENUM={LINECAP:{DEFAULT:"butt",BUTT:"butt",ROUND:"round",SQUARE:"square"},TEXTALIGN:{X:{DEFAULT:"start",START:"start",END:"end",CENTER:"center",LEFT:"left",RIGHT:"right"},Y:{DEFAULT:"alphabetic",ALPHABETIC:"alphabetic",TOP:"top",HANGING:"hanging",MIDDLE:"middle",CENTER:"middle",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"}}},document.addEventListener("keydown",t=>{if(this.keys.altPressed=t.altKey,this.keys.shiftPressed=t.shiftKey,this.keys.ctrlPressed=t.ctrlKey,this.keys.keysDown[t.key]=this.keys.keysDown[t.keyCode]=this.keys.keysDown[t.code]=!0,this.eventHandler.fireEvent("keydown",t),"function"==typeof window.OnKeyDown&&window.OnKeyDown(t),this.disableKeyShortcuts)return t.preventDefault(),!1}),document.addEventListener("keyup",t=>{this.keys.altPressed=t.altKey,this.keys.shiftPressed=t.shiftKey,this.keys.ctrlPressed=t.ctrlKey,this.keys.keysDown[t.key]=this.keys.keysDown[t.keyCode]=this.keys.keysDown[t.code]=!1,this.eventHandler.fireEvent("keyup",t),"function"==typeof window.OnKeyUp&&window.OnKeyUp(t)}),this.canvas.addEventListener("mousemove",t=>{let e=this.canvas.getBoundingClientRect();this.mouse.x=(t.clientX-e.left)/(e.width/this.width),this.mouse.y=(t.clientY-e.top)/(e.height/this.height),this.mouse.movementX=t.movementX,this.mouse.movementY=t.movementY,this.eventHandler.fireEvent("mousemove",t),"function"==typeof window.OnMouseMove&&window.OnMouseMove(t)}),document.addEventListener("mousemove",t=>{this.pan.isPanning&&this.eventHandler.fireEvent("pan",{x:t.movementX,y:t.movementY})}),this.canvas.addEventListener("mousedown",t=>{let e=t.button;if(e<3&&(this.mouse[this.mouseLookupTable[e]]=!0),this.mouse.any=this.mouse.left||this.mouse.right||this.mouse.middle,this.eventHandler.fireEvent("mousedown",t),"function"==typeof window.OnMouseDown&&window.OnMouseDown(t),this.pan.isPanning=!0,1==e&&this.disableMiddleMouse)return t.preventDefault(),!1}),document.addEventListener("mouseup",t=>{this.pan.isPanning=!1}),this.canvas.addEventListener("mouseup",t=>{let e=t.button;e<3&&(this.mouse[this.mouseLookupTable[e]]=!1),this.mouse.any=this.mouse.left||this.mouse.right||this.mouse.middle||this.touch.touches.length>0,this.eventHandler.fireEvent("mouseup",t),"function"==typeof window.OnMouseUp&&window.OnMouseUp(t)}),this.canvas.addEventListener("contextmenu",t=>(this.eventHandler.fireEvent("contextmenu",t),"function"==typeof window.OnContextMenu&&window.OnContextMenu(t),!this.disableContextMenu||(t.preventDefault(),!1))),this.canvas.addEventListener("wheel",t=>{this.mouse.scrollX=t.deltaX,this.mouse.scrollY=t.deltaY,this.mouse.scrollZ=t.deltaZ,this.eventHandler.fireEvent("scroll",t),"function"==typeof window.OnScroll&&window.OnScroll(t)}),this.updateTouches=function(t){const e=this.canvas.getBoundingClientRect();this.touch.touches=[];for(let i=0;i<t.touches.length;i++){const s=t.touches[i],n=(s.pageX-e.left)/(e.width/this.width),o=(s.pageY-e.top)/(e.height/this.height);this.touch.touches[i]={x:n,y:o,id:s.identifier,force:s.force,radiusX:s.radiusX,radiusY:s.radiusY,rotationAngle:s.rotationAngle}}},this.canvas.addEventListener("touchmove",t=>{if(this.disableScrollOnMobile&&t.preventDefault(),this.updateTouches(t),this.touch.x=this.touch.touches[0].x,this.touch.y=this.touch.touches[0].y,this.touch.touches.length===this.touch.lastTouches.length){const t=n(this.touch.touches.map(t=>t.x)),e=n(this.touch.touches.map(t=>t.y)),i=n(this.touch.lastTouches.map(t=>t.x)),s=n(this.touch.lastTouches.map(t=>t.y));this.touch.movementX=t-i,this.touch.movementY=e-s}else this.touch.movementX=0,this.touch.movementY=0;if(this.eventHandler.fireEvent("touchmove",t),"function"==typeof window.OnTouchMove&&window.OnTouchMove(t),this.pan.isPanning&&this.eventHandler.fireEvent("pan",{x:this.touch.movementX,y:this.touch.movementY}),2===this.touch.touches.length&&2===this.touch.lastTouches.length){const t=this.getDistance(this.touch.touches[0].x,this.touch.touches[0].y,this.touch.touches[1].x,this.touch.touches[1].y),e=10*(this.getDistance(this.touch.lastTouches[0].x,this.touch.lastTouches[0].y,this.touch.lastTouches[1].x,this.touch.lastTouches[1].y)-t),i={x:(this.touch.touches[0].x+this.touch.touches[1].x)/2,y:(this.touch.touches[0].y+this.touch.touches[1].y)/2};this.eventHandler.fireEvent("pinch",{pinch:e,center:i})}this.touch.lastX=this.touch.x,this.touch.lastY=this.touch.y,this.touch.lastTouches=[...this.touch.touches]}),this.canvas.addEventListener("touchstart",t=>{this.disableScrollOnMobile&&t.preventDefault(),this.updateTouches(t),this.touch.x=this.touch.touches[0].x,this.touch.y=this.touch.touches[0].y,this.touch.isTouching=!0,this.mouse.any=!0,this.pan.isPanning=!0,this.eventHandler.fireEvent("touchstart",t),"function"==typeof window.OnTouchStart&&window.OnTouchStart(t),this.touch.lastX=this.touch.x,this.touch.lastY=this.touch.y,this.touch.lastTouches=[...this.touch.touches]}),this.canvas.addEventListener("touchend",t=>{this.disableScrollOnMobile&&t.preventDefault(),this.updateTouches(t),this.touch.isTouching=this.touch.touches.length>0,this.mouse.any=this.mouse.left||this.mouse.right||this.mouse.middle||this.touch.touches.length>0,this.touch.isTouching||(this.pan.isPanning=!1),this.eventHandler.fireEvent("touchend",t),"function"==typeof window.OnTouchEnd&&window.OnTouchEnd(t)}),window.addEventListener("resize",t=>{this.isFullpage?h(this,window.innerWidth+1,window.innerHeight+1):h(this,o,a),this.eventHandler.fireEvent("resize",t),"function"==typeof window.OnResize&&window.OnResize(t)}),this.publicMethods){const t=["constructor","width","height","moveTo"],e=["width","height"],s=["mouse","touch"],n=Object.getOwnPropertyNames(i.prototype);for(const e of n)t.includes(e)||(window.hasOwnProperty(e)?console.warn("[GameCanvas] Window already has property: "+e):window[e]=this[e].bind(this));for(const t of e)Object.defineProperty(window,t,{get:function(t,e){return function(){return t[e]}}(this,t),set:function(t,e){return function(i){t[e]=i}}(this,t),configurable:!0});for(const t of s)Object.defineProperty(window,t,{get:function(t,e){return function(){return t[e]}}(this,t),configurable:!0})}}get width(){return this.canvas.width/this.dpr}get height(){return this.canvas.height/this.dpr}set width(t){h(this,t,null)}set height(t){h(this,null,t)}requestFullscreen(){this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.mozRequestFullScreen?this.canvas.mozRequestFullScreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen()}exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}lockPointer(){this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock,this.canvas.requestPointerLock()}unlockPointer(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.exitPointerLock()}clearScreen(){this.ctx.clearRect(0,0,this.width,this.height)}background(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width,this.height)}arc(t,e,i,s,n,o){this.ctx.arc(t,e,i,s,n,o)}circle(t,e,i,s,n,o){this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.fillStyle=s,n&&(this.ctx.strokeStyle=n),o&&(this.ctx.lineWidth=o),this.ctx.fill(),n&&this.ctx.stroke()}ring(t,e,i,s,n){this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.strokeStyle=s,n&&(this.ctx.lineWidth=n),this.ctx.stroke()}ellipse(t,e,i,s,n,o=0,h,a){this.ctx.beginPath(),this.ctx.ellipse(t,e,i,s,o,0,2*Math.PI),this.ctx.fillStyle=n,h&&(this.ctx.strokeStyle=h),a&&(this.ctx.lineWidth=a),this.ctx.fill(),h&&this.ctx.stroke()}rectangle(t,e,i,s,n,o,h){n&&(this.ctx.fillStyle=n),h&&(this.ctx.lineWidth=h),o?(this.ctx.beginPath(),this.ctx.strokeStyle=o,this.ctx.rect(t,e,i,s),n&&this.ctx.fill(),this.ctx.stroke()):this.ctx.fillRect(t,e,i,s)}roundedRectangle(t,e,i,s,n,o,h,a){"number"==typeof o&&(o=[o,o,o,o]),this.ctx.beginPath(),this.ctx.arc(t+o[0],e+o[0],o[0],Math.PI,1.5*Math.PI),this.ctx.lineTo(t+i-o[1],e),this.ctx.arc(t+i-o[1],e+o[1],o[1],1.5*Math.PI,2*Math.PI),this.ctx.lineTo(t+i,e+s-o[2]),this.ctx.arc(t+i-o[2],e+s-o[2],o[2],0,.5*Math.PI),this.ctx.lineTo(t+o[3],e+s),this.ctx.arc(t+o[3],e+s-o[3],o[3],.5*Math.PI,Math.PI),this.ctx.closePath(),h&&(a&&(this.ctx.lineWidth=a),this.ctx.strokeStyle=h,this.ctx.stroke()),this.ctx.fillStyle=n,this.ctx.fill()}triangle(t,e,i,s,n,o,h,a,r){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.lineTo(n,o),this.ctx.closePath(),this.ctx.fillStyle=h,r&&(this.ctx.lineWidth=r),this.ctx.fill(),a&&(this.ctx.strokeStyle=a,this.ctx.stroke())}line(t,e,i,s,n,o){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),n&&(this.ctx.strokeStyle=n),o&&(this.ctx.lineWidth=o),this.ctx.stroke()}pixelPerfectLine(t,e,i,s,n,o){const h=t===i?0:1,r=e===s?0:1;t=a(this,t,o*r),e=a(this,e,o*h),i=a(this,i,o*r),s=a(this,s,o*h);const c=1/this.dpr;this.line(t,e,i,s,n,o*c)}clippedPicture(t,e,i,s,n,h,a,r,c){const l=this.images[t];if(l)o(l)||(r=r||l.width,c=c||l.height,this.ctx.drawImage(l,e,i,s,n,h,a,r,c));else{const o=new Image;o.src=t,o.onload=()=>{r=r||o.width,c=c||o.height,this.ctx.drawImage(o,e,i,s,n,h,a,r,c)},this.images[t]=o}}picture(t,e,i,s,n){if(t instanceof HTMLImageElement){const o=t;return void this.ctx.drawImage(o,e,i,s,n)}const h=this.images[t];if(h)o(h)||(s=s||h.width,n=n||h.height,this.ctx.drawImage(h,e,i,s,n));else{const o=new Image;o.src=t,o.onload=()=>{s=s||o.width,n=n||o.height,this.ctx.drawImage(o,e,i,s,n)},this.images[t]=o}}text(t,e,i,s,n,o,h){this.ctx.beginPath(),this.ctx.font=this.fontWeight+" "+s+"px "+this.font,this.ctx.fillStyle=n,h&&(this.ctx.lineWidth=h),this.ctx.fillText(t,e,i),o&&(this.ctx.strokeStyle=o,this.ctx.strokeText(t,e,i))}drawVector(t,e,i,s=1,n="black"){const o=10;if(0===Math.sqrt(i.x*i.x+i.y*i.y))return void this.circle(t,e,4,n);const h=this.normalizeVector(i),a=-h.y,r=h.x,c=t+i.x*s,l=e+i.y*s;this.line(t,e,c-h.x*o,l-h.y*o,n,2),this.triangle(c,l,c-h.x*o+a*o*.4,l-h.y*o+r*o*.4,c-h.x*o-a*o*.4,l-h.y*o-r*o*.4,n)}polygon(t,e,i,s,n,o,h){this.ctx.beginPath(),this.ctx.moveTo(t[0].x+e,t[0].y+i);for(let s=1;s<t.length;s++){const n=t[s];this.ctx.lineTo(n.x+e,n.y+i)}s&&this.ctx.closePath(),n&&(this.ctx.fillStyle=n,this.ctx.fill()),o&&(h&&(this.ctx.lineWidth=h),this.ctx.strokeStyle=o,this.ctx.stroke())}rgb(t=0,e=0,i=0){return`rgb(${t}, ${e}, ${i})`}rgba(t=0,e=0,i=0,s=1){return`rgba(${t}, ${e}, ${i}, ${s})`}hsl(t=0,e=0,i=0){return`hsl(${t}, ${e}%, ${i}%)`}hsla(t=0,e=0,i=0,s=1){return`hsla(${t}, ${e}%, ${i}%, ${s})`}grayscale(t=0){return this.rgb(t,t,t)}greyscale(t=0){return this.grayscale(t)}getPixelData(){this.imageData=this.ctx.getImageData(0,0,this.fastBufferWidth,this.fastBufferHeight),this.imageDataData=this.imageData.data}updatePixel(t,e,i,s,n,o=255){if(!this.imageDataData)throw new Error("Call getPixelData before updating pixels");let h=4*(t+e*this.fastBufferWidth);this.imageDataData[h]=i,this.imageDataData[h+1]=s,this.imageDataData[h+2]=n,this.imageDataData[h+3]=o}updatePixelIndex(t,e,i,s,n=255){if(!this.imageDataData)throw new Error("Call getPixelData before updating pixels");const o=4*t;this.imageDataData[o]=e,this.imageDataData[o+1]=i,this.imageDataData[o+2]=s,this.imageDataData[o+3]=n}getPixel(t,e){if(!this.imageDataData)throw new Error("Call getPixelData before reading pixels");let i=4*(t+e*this.fastBufferWidth);return[this.imageDataData[i],this.imageDataData[i+1],this.imageDataData[i+2],this.imageDataData[i+3]]}getPixelIndex(t){if(!this.imageDataData)throw new Error("Call getPixelData before reading pixels");let e=4*t;return[this.imageDataData[e],this.imageDataData[e+1],this.imageDataData[e+2],this.imageDataData[e+3]]}renderPixelData(t=0,e=0){if(!this.imageData)throw new Error("Call getPixelData before rendering pixels");this.ctx.putImageData(this.imageData,t*this.dpr,e*this.dpr)}save(){this.ctx.save()}restore(){this.ctx.restore()}rotate(t){this.ctx.rotate(t)}translate(t,e){this.ctx.translate(t,e)}beginPath(){this.ctx.beginPath()}closePath(){this.ctx.closePath()}penTo(t,e){this.ctx.moveTo(t,e)}moveTo(t,e){this.ctx.moveTo(t,e)}lineTo(t,e){this.ctx.lineTo(t,e)}quadraticCurveTo(t,e,i,s){this.ctx.quadraticCurveTo(t,e,i,s)}quadraticTo(t,e,i,s){this.ctx.quadraticCurveTo(t,e,i,s)}bezierCurveTo(t,e,i,s,n,o){this.ctx.bezierCurveTo(t,e,i,s,n,o)}bezierTo(t,e,i,s,n,o){this.ctx.bezierCurveTo(t,e,i,s,n,o)}fill(){this.ctx.fill()}stroke(){this.ctx.stroke()}fillStyle(t){this.ctx.fillStyle=t}strokeStyle(t){this.ctx.strokeStyle=t}setLineWidth(t){this.ctx.lineWidth=t}lineWidth(t){this.ctx.lineWidth=t}strokeWeight(t){this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=t}resetLineCap(){this.ctx.lineCap="butt"}setFont(t){this.font=t}setTextAlign(t){this.ctx.textAlign=t}setTextXAlign(t){this.ctx.textAlign=t}setTextAlignX(t){this.ctx.textAlign=t}setTextYAlign(t){this.ctx.textBaseline=t}setTextAlignY(t){this.ctx.textBaseline=t}resetTextXAlign(){this.ctx.textAlign="left"}resetTextAlignX(){this.ctx.textAlign="left"}resetTextYAlign(){this.ctx.textBaseline="alphabetic"}resetTextAlignY(){this.ctx.textBaseline="alphabetic"}clip(){this.ctx.clip()}setShadowOffset(t=0,e=0){this.ctx.shadowOffsetX=t,this.ctx.shadowOffsetY=e}setShadowBlur(t=0){this.ctx.shadowBlur=t}setShadowColor(t="transparent"){this.ctx.shadowColor=t}applyShadow(t){const e=t.split(" "),i=e[0].replace("px",""),s=e[1].replace("px",""),n=e[2].replace("px",""),o=e[3];this.ctx.shadowOffsetX=i,this.ctx.shadowOffsetY=s,this.ctx.shadowBlur=n,this.ctx.shadowColor=o}clearShadow(){this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowColor=this.rgba(0,0,0,0)}createSound(t,e=1,i=0,s=!1){const n=new Audio(t);return n.loop=s,n.currentTime=i,n.volume=e,{volume:e,startTime:i,audio:n}}playSound(t){t.audio.currentTime=t.startTime,t.audio.volume=t.volume,t.audio.play()}stopSound(t){t.audio.stop()}pauseSound(t){t.audio.pause()}backgroundMusic(t){const e=new Audio(t);return e.loop=!0,e.play(),e}fadeOutSound(t,e=1){const i=t.volume;let s=0;const n=setInterval(()=>{t.audio.volume=i/(20*e)*(20*e-s),s++,s>20*e&&(t.audio.pause(),clearInterval(n))},50)}playTone(t=440,e=1,i=1,s="sine"){const n=this.audioContext.createOscillator(),o=this.audioContext.createGain();o.gain.value=i,o.connect(this.audioContext.destination),n.type=s,n.frequency.value=t,n.connect(o),n.start(),setTimeout(()=>{n.stop()},1e3*e)}getDistanceSqr(t,e,i,s){const n=t-i,o=e-s;return n*n+o*o}getDistanceSqr3D(t,e,i,s,n,o){const h=t-i,a=e-s,r=n-o;return h*h+a*a+r*r}getDistance(t,e,i,s){return Math.sqrt(this.getDistanceSqr(t,e,i,s))}getDistance3D(t,e,i,s,n,o){return Math.sqrt(this.getDistanceSqr3D(t,e,i,s,n,o))}getAngle(t,e,i,s){return Math.atan2(s-e,i-t)}vectorLength(t){return Math.sqrt(t.x*t.x+t.y*t.y)}normalize(t,e){const i=Math.sqrt(t*t+e*e);return{x:t/i,y:e/i}}normalizeVector(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}}normalize3D(t,e,i){const s=Math.sqrt(t*t+e*e+i*i);return 0===s?{x:0,y:0,z:0}:{x:t/s,y:e/s,z:i/s}}normalize3DVector(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return{x:t.x/e,y:t.y/e,z:t.z/e}}lengthVector(t){return Math.sqrt(t.x*t.x+t.y*t.y)}length3DVector(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}dot(t,e){return t.x*e.x+t.y*e.y}dot3D(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}crossProduct3D(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}rectanglesIntersect(t,e,i,s,n,o,h,a){return t+i>n&&t<n+h&&e+s>o&&e<o+a}circlesIntersect(t,e,i,s,n,o){return this.getDistance(t,e,s,n)<i+o}circleRectangleIntersect(t,e,i,s,n,o,h){const a=Math.abs(t-(s+o/2)),r=Math.abs(e-(n+h/2));if(a>o/2+i)return!1;if(r>h/2+i)return!1;if(a<=o/2)return!0;if(r<=h/2)return!0;const c=a-o/2,l=r-h/2;return c*c+l*l<=i*i}random(t){return Math.random()*t}randomInt(t){return Math.random()*t|0}randomArray(t){return t[Math.floor(Math.random()*t.length)]}randomColor(t){if("number"!=typeof t||isNaN(t))return"rgb("+(256*Math.random()|0)+","+(256*Math.random()|0)+","+(256*Math.random()|0)+")";{if(0===t)throw Error("Colordepth cannot be 0");const e=256/t;return"rgb("+Math.ceil(Math.floor(256*Math.random())/e)*e+","+Math.ceil(Math.floor(256*Math.random())/e)*e+","+Math.ceil(Math.floor(256*Math.random())/e)*e+")"}}canvasToURL(){return this.canvas.toDataURL()}canvasToImage(){const t=new Image;return t.src=this.canvas.toDataURL(),t}saveToFile(t="canvas.png"){const e=document.createElement("a");e.download=t,e.href=this.canvas.toDataURL(),e.click()}setCookie(t,e,i=36500){let s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3);let n="expires="+s.toUTCString();document.cookie=t+"="+e+";"+n+";path=/"}getCookie(t){if(0==t.length)return!1;const e=t+"=",i=document.cookie.split(";");for(let t=0;t<i.length;t++){let s=i[t];const n=s.indexOf(e);if(n>0)return s.substr(n+e.length)}return!1}deleteCookie(t){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/"}isCtrlPressed(){return this.keys.ctrlPressed}isAltPressed(){return this.keys.AltPressed}isShiftPressed(){return this.keys.shiftPressed}key(t){return!!this.keys.keysDown[t]}shuffleArray(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t}shuffledArray(t){const e=[...t];for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}map2DArray(t,e){const i=t.length,s=t[0].length;let n=0;for(let o=0;o<i;o++)for(let i=0;i<s;i++)t[o][i]=e(o,i,n),n++}create2DArray(t,e,i=(t,e)=>0){const s=new Array(t);for(let n=0;n<t;n++){s[n]=new Array(e);for(let t=0;t<e;t++)s[n][t]=i(n,t)}return s}copy2DArray(t,e){const i=t.length,s=t[0].length,n=t.length,o=t[0].length;if(i!=n||s!=o)throw new Error("Dimension mismatch");for(let n=0;n<i;n++)for(let i=0;i<s;i++)e[n][i]=t[n][i];return e}clamp(t,e,i){return Math.max(e,Math.min(i,t))}clamp01(t){return this.clamp(t,0,1)}lerp(t,e,i){return t*(1-i)+e*i}mapValue(t,e,i,s,n){return(t-e)*(n-s)/(i-e)+s}roundNearest(t,e){return Math.round(t/e)*e}floorNearest(t,e){return Math.floor(t/e)*e}ceilNearest(t,e){return Math.ceil(t/e)*e}gradient(t,e,i,s,n,o){const h=this.ctx.createLinearGradient(i,s,n,o);return h.addColorStop(0,t),h.addColorStop(1,e),h}prettyPrint(t){console.log(JSON.stringify(t,null,2))}setCursor(t){this.canvas.style.cursor=t}}function s(){this.events={},this.addEvent=this.on=function(t,e){if("function"!=typeof e)throw new Error("[EventHandler]: Not a function");this.events[t]?this.events[t].functions.push(e):this.events[t]={functions:[e]}},this.removeEvent=this.off=function(t,e){var i=this.events[t];if(i){var s=i.functions.indexOf(e);-1!==s&&i.functions.splice(s,1)}},this.fireEvent=function(t,...e){if(this.events[t]){for(var i of this.events[t].functions)i(...e);return!0}return!1}}function n(t){return t.reduce((t,e)=>t+e,0)/t.length}function o(t){return!t.complete||0===t.naturalWidth}function h(t,e,i){t._forceUpdatePixelRatio();const s=t.dpr;if(null!=e){const i=Math.ceil(e*s);t.canvas.width=i,t.canvas.style.width=i/s+"px",t.fastBufferWidth=i,t.fastStyleWidth=Math.round(i/s)}if(null!=i){const e=Math.ceil(i*s);t.canvas.height=e,t.canvas.style.height=e/s+"px",t.fastBufferHeight=e,t.fastStyleHeight=Math.round(e/s)}t.ctx.scale(s,s)}function a(t,e,i){const s=1/t.dpr;return t.floorNearest(e,s)+s/2*i}return e.default})());